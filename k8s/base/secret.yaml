# ==============================================
# Kubernetes Secrets
# Phase 9: Containerization & Cloud Native
# ==============================================
# IMPORTANT: This is a template. Do NOT commit real secrets to git.
# Use sealed-secrets, external-secrets, or cloud-native secret management.

apiVersion: v1
kind: Secret
metadata:
  name: advancedconcepts-secrets
  namespace: default
  labels:
    app: advancedconcepts
    component: secrets
    version: v1.0.0
type: Opaque
stringData:
  # Database Connection (if applicable)
  # DO NOT use plain text in production - use Azure Key Vault, AWS Secrets Manager, etc.
  DATABASE_CONNECTION_STRING: ""

  # API Keys
  EXTERNAL_API_KEY: ""

  # Application Insights (Azure)
  APPLICATIONINSIGHTS_CONNECTION_STRING: ""
  APPLICATIONINSIGHTS_INSTRUMENTATION_KEY: ""

  # Seq API Key (if authentication enabled)
  SEQ_API_KEY: ""

  # JWT Signing Key (if using JWT authentication)
  JWT_SECRET_KEY: ""

  # Encryption Keys
  DATA_PROTECTION_KEY: ""

---
# Example: Using External Secrets Operator (recommended for production)
# apiVersion: external-secrets.io/v1beta1
# kind: ExternalSecret
# metadata:
#   name: advancedconcepts-external-secrets
#   namespace: default
# spec:
#   refreshInterval: 1h
#   secretStoreRef:
#     name: azure-keyvault-store  # or aws-secrets-manager-store
#     kind: SecretStore
#   target:
#     name: advancedconcepts-secrets
#     creationPolicy: Owner
#   data:
#     - secretKey: DATABASE_CONNECTION_STRING
#       remoteRef:
#         key: db-connection-string
#     - secretKey: APPLICATIONINSIGHTS_CONNECTION_STRING
#       remoteRef:
#         key: appinsights-connection

---
# Example: Using Sealed Secrets (encrypted in git)
# apiVersion: bitnami.com/v1alpha1
# kind: SealedSecret
# metadata:
#   name: advancedconcepts-sealed-secrets
#   namespace: default
# spec:
#   encryptedData:
#     DATABASE_CONNECTION_STRING: AgA...  # Encrypted by kubeseal
#     API_KEY: AgB...                      # Encrypted by kubeseal

---
# RBAC for Secret Access
apiVersion: v1
kind: ServiceAccount
metadata:
  name: advancedconcepts-sa
  namespace: default
  labels:
    app: advancedconcepts

---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  name: advancedconcepts-secret-reader
  namespace: default
rules:
  - apiGroups: [""]
    resources: ["secrets"]
    resourceNames: ["advancedconcepts-secrets"]
    verbs: ["get"]
  - apiGroups: [""]
    resources: ["configmaps"]
    resourceNames: ["advancedconcepts-config", "advancedconcepts-appsettings"]
    verbs: ["get"]

---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  name: advancedconcepts-secret-reader-binding
  namespace: default
subjects:
  - kind: ServiceAccount
    name: advancedconcepts-sa
    namespace: default
roleRef:
  kind: Role
  name: advancedconcepts-secret-reader
  apiGroup: rbac.authorization.k8s.io
