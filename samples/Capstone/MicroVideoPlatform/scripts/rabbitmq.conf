# ============================================================================
# RabbitMQ Configuration for Micro-Video Platform
# ============================================================================

# ============================================================================
# NETWORK SETTINGS
# ============================================================================

# Listen on all interfaces
listeners.tcp.default = 5672

# Management plugin
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# ============================================================================
# DEFINITIONS (Auto-import on startup)
# ============================================================================

# Load definitions from JSON file
management.load_definitions = /etc/rabbitmq/definitions.json

# ============================================================================
# RESOURCE LIMITS
# ============================================================================

# Disk free space limit (absolute)
disk_free_limit.absolute = 2GB

# Memory limit (relative to total)
vm_memory_high_watermark.relative = 0.6

# Maximum number of connections
num_acceptors.tcp = 10

# ============================================================================
# MESSAGE PERSISTENCE
# ============================================================================

# Queue master locator
queue_master_locator = min-masters

# Lazy queues (reduce memory usage)
queue_default_lazy_mode = false

# ============================================================================
# CLUSTERING (for future multi-node setup)
# ============================================================================

# Cluster name
cluster_name = microvideo-rabbitmq-cluster

# Cluster partition handling
cluster_partition_handling = autoheal

# ============================================================================
# LOGGING
# ============================================================================

# Log level: debug, info, warning, error
log.console.level = info

# Log file
log.file.level = info

# ============================================================================
# MANAGEMENT UI
# ============================================================================

# Enable management plugin
management.listener.port = 15672
management.listener.ssl = false

# CORS settings (for API access from different origins)
management.cors.allow_origins.1 = *
management.cors.allow_origins.2 = http://localhost:3000
management.cors.max_age = 3600

# ============================================================================
# PERFORMANCE TUNING
# ============================================================================

# Channel max
channel_max = 2048

# Heartbeat interval
heartbeat = 60

# Frame max (bytes)
frame_max = 131072

# Prefetch count (default for consumers)
consumer_prefetch = 250

# ============================================================================
# SECURITY
# ============================================================================

# Default user (overridden by environment variables)
default_user = guest
default_pass = guest

# Default permissions
default_permissions.configure = .*
default_permissions.read = .*
default_permissions.write = .*

# Default vhost
default_vhost = /

# ============================================================================
# PLUGINS
# ============================================================================

# Enable plugins
# These are typically enabled via rabbitmq-plugins, but documented here
# - rabbitmq_management (Management UI)
# - rabbitmq_management_agent
# - rabbitmq_web_dispatch

# ============================================================================
# MESSAGE STORE
# ============================================================================

# Message store index embeddings
msg_store_index_embeddings = true

# Queue index embeddings
queue_index_embed_msgs_below = 4096

# ============================================================================
# TIMEOUTS
# ============================================================================

# Handshake timeout
handshake_timeout = 10000

# Connection timeout
tcp_listen_options.keepalive = true
tcp_listen_options.nodelay = true

# ============================================================================
# PRODUCTION RECOMMENDATIONS
# ============================================================================

# For production:
# 1. Increase disk_free_limit.absolute based on expected message volume
# 2. Set vm_memory_high_watermark.relative to 0.4-0.5 for safety
# 3. Enable clustering for high availability
# 4. Use SSL/TLS for connections (management.listener.ssl = true)
# 5. Disable guest user and create dedicated users
# 6. Set up monitoring with Prometheus plugin
# 7. Configure backup strategy for definitions
# 8. Use persistent messages for critical events
