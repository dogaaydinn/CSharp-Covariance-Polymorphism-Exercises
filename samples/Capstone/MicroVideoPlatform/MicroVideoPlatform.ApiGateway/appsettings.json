{
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft.AspNetCore": "Warning",
      "Yarp": "Information"
    }
  },
  "AllowedHosts": "*",

  "ReverseProxy": {
    "Routes": {
      "content-api-route": {
        "ClusterId": "content-cluster",
        "Match": {
          "Path": "/api/content/{**catch-all}"
        },
        "Transforms": [
          { "PathRemovePrefix": "/api/content" },
          { "RequestHeaderOriginalHost": "true" }
        ],
        "Metadata": {
          "Yarp.RateLimiting.RateLimitPolicy": "standard"
        }
      },
      "videos-route": {
        "ClusterId": "content-cluster",
        "Match": {
          "Path": "/api/videos/{**catch-all}"
        },
        "Transforms": [
          { "RequestHeaderOriginalHost": "true" }
        ],
        "Metadata": {
          "Yarp.RateLimiting.RateLimitPolicy": "standard"
        }
      },
      "processing-worker-route": {
        "ClusterId": "processing-cluster",
        "Match": {
          "Path": "/api/processing/{**catch-all}"
        },
        "Transforms": [
          { "PathRemovePrefix": "/api/processing" },
          { "RequestHeaderOriginalHost": "true" }
        ],
        "Metadata": {
          "Yarp.RateLimiting.RateLimitPolicy": "strict"
        }
      },
      "analytics-function-route": {
        "ClusterId": "analytics-cluster",
        "Match": {
          "Path": "/api/analytics/{**catch-all}"
        },
        "Transforms": [
          { "PathRemovePrefix": "/api/analytics" },
          { "RequestHeaderOriginalHost": "true" }
        ],
        "Metadata": {
          "Yarp.RateLimiting.RateLimitPolicy": "standard"
        }
      },
      "recommendations-route": {
        "ClusterId": "analytics-cluster",
        "Match": {
          "Path": "/api/recommendations/{**catch-all}"
        },
        "Transforms": [
          { "RequestHeaderOriginalHost": "true" }
        ],
        "Metadata": {
          "Yarp.RateLimiting.RateLimitPolicy": "standard"
        }
      },
      "aggregated-video-route": {
        "ClusterId": "gateway-cluster",
        "Match": {
          "Path": "/api/aggregated/video/{videoId}"
        },
        "Metadata": {
          "Yarp.RateLimiting.RateLimitPolicy": "standard"
        }
      },
      "admin-route": {
        "ClusterId": "content-cluster",
        "Match": {
          "Path": "/api/admin/{**catch-all}"
        },
        "AuthorizationPolicy": "admin-only",
        "Transforms": [
          { "PathRemovePrefix": "/api/admin" },
          { "RequestHeaderOriginalHost": "true" }
        ]
      },
      "web-ui-route": {
        "ClusterId": "webui-cluster",
        "Match": {
          "Path": "/{**catch-all}"
        },
        "Transforms": [
          { "RequestHeaderOriginalHost": "true" }
        ]
      }
    },
    "Clusters": {
      "content-cluster": {
        "Destinations": {
          "content1": {
            "Address": "http://localhost:5001/"
          }
        },
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:10",
            "Timeout": "00:00:05",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          },
          "Passive": {
            "Enabled": true,
            "Policy": "TransportFailureRate",
            "ReactivationPeriod": "00:01:00"
          }
        },
        "HttpClient": {
          "DangerousAcceptAnyServerCertificate": false,
          "RequestHeaderEncoding": "utf-8"
        }
      },
      "processing-cluster": {
        "Destinations": {
          "processing1": {
            "Address": "http://localhost:6000/"
          }
        },
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:15",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/health"
          }
        }
      },
      "analytics-cluster": {
        "Destinations": {
          "analytics1": {
            "Address": "http://localhost:7071/"
          }
        },
        "LoadBalancingPolicy": "RoundRobin",
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:15",
            "Timeout": "00:00:10",
            "Policy": "ConsecutiveFailures",
            "Path": "/api/health"
          }
        }
      },
      "webui-cluster": {
        "Destinations": {
          "webui1": {
            "Address": "http://localhost:5000/"
          }
        },
        "HealthCheck": {
          "Active": {
            "Enabled": true,
            "Interval": "00:00:30",
            "Timeout": "00:00:10",
            "Path": "/health"
          }
        }
      },
      "gateway-cluster": {
        "Destinations": {
          "gateway-local": {
            "Address": "http://localhost/"
          }
        }
      }
    }
  },

  "ServiceUrls": {
    "ContentApi": "http://localhost:5001",
    "ProcessingWorker": "http://localhost:6000",
    "AnalyticsFunction": "http://localhost:7071",
    "WebUi": "http://localhost:5000"
  },

  "Jwt": {
    "Secret": "your-secret-key-here-change-in-production-minimum-32-characters",
    "Issuer": "MicroVideoPlatform.ApiGateway",
    "Audience": "MicroVideoPlatform.Services",
    "ExpirationMinutes": 60
  },

  "RateLimiting": {
    "Standard": {
      "PermitLimit": 100,
      "Window": "00:01:00",
      "QueueLimit": 10
    },
    "Strict": {
      "PermitLimit": 20,
      "Window": "00:01:00",
      "QueueLimit": 5
    },
    "Premium": {
      "PermitLimit": 500,
      "Window": "00:01:00",
      "QueueLimit": 50
    }
  },

  "Redis": {
    "ConnectionString": "localhost:6379",
    "InstanceName": "ApiGateway:"
  },

  "Caching": {
    "DefaultExpirationMinutes": 5,
    "Routes": {
      "/api/videos/": 5,
      "/api/recommendations/": 2,
      "/api/analytics/": 10
    }
  },

  "CircuitBreaker": {
    "FailureThreshold": 5,
    "DurationOfBreakSeconds": 30,
    "SamplingDurationSeconds": 60
  },

  "Retry": {
    "MaxRetryAttempts": 3,
    "InitialDelaySeconds": 1,
    "BackoffMultiplier": 2
  },

  "OpenTelemetry": {
    "ServiceName": "ApiGateway",
    "ServiceVersion": "1.0.0",
    "OtlpExporterEndpoint": "http://localhost:4317"
  },

  "Seq": {
    "ServerUrl": "http://localhost:5341",
    "ApiKey": ""
  }
}
