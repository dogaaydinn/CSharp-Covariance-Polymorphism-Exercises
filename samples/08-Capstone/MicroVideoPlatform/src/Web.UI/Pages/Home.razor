@page "/"
@inject HttpClient Http

<PageTitle>Home</PageTitle>

<h2>Video Catalog</h2>

@if (videos == null)
{
    <p><em>Loading videos...</em></p>
}
else if (videos.Count == 0)
{
    <p><em>No videos available. Upload your first video!</em></p>
}
else
{
    <div class="video-grid">
        @foreach (var video in videos)
        {
            <div class="video-card">
                <div class="video-thumbnail">
                    <div class="play-icon">â–¶</div>
                </div>
                <h3>@video.Title</h3>
                <p>Status: <span class="status-@video.Status.ToLower()">@video.Status</span></p>
                <p>Views: @video.ViewCount</p>
                <p>Uploaded: @video.UploadedAt.ToString("yyyy-MM-dd HH:mm")</p>
            </div>
        }
    </div>
}

<div class="upload-section">
    <h3>Upload New Video</h3>
    <input @bind="newVideoTitle" placeholder="Video title" />
    <input @bind="newVideoUrl" placeholder="Video URL" />
    <button @onclick="UploadVideo">Upload</button>

    @if (!string.IsNullOrEmpty(uploadMessage))
    {
        <p class="@(uploadSuccess ? "success" : "error")">@uploadMessage</p>
    }
</div>

@code {
    private List<VideoDto>? videos;
    private string newVideoTitle = "";
    private string newVideoUrl = "";
    private string uploadMessage = "";
    private bool uploadSuccess = false;

    protected override async Task OnInitializedAsync()
    {
        await LoadVideos();
    }

    private async Task LoadVideos()
    {
        try
        {
            videos = await Http.GetFromJsonAsync<List<VideoDto>>("api/videos");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading videos: {ex.Message}");
            videos = new List<VideoDto>();
        }
    }

    private async Task UploadVideo()
    {
        try
        {
            var response = await Http.PostAsJsonAsync("api/videos", new
            {
                title = newVideoTitle,
                url = newVideoUrl
            });

            if (response.IsSuccessStatusCode)
            {
                uploadMessage = "Video uploaded successfully!";
                uploadSuccess = true;
                newVideoTitle = "";
                newVideoUrl = "";
                await LoadVideos();
            }
            else
            {
                uploadMessage = "Failed to upload video";
                uploadSuccess = false;
            }
        }
        catch (Exception ex)
        {
            uploadMessage = $"Error: {ex.Message}";
            uploadSuccess = false;
        }
    }

    public record VideoDto(Guid Id, string Title, string Url, string Status, DateTime UploadedAt, int ViewCount);
}

<style>
    .video-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 40px;
    }
    .video-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        background: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .video-thumbnail {
        width: 100%;
        height: 160px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 10px;
    }
    .play-icon {
        font-size: 48px;
        color: white;
    }
    .video-card h3 {
        margin: 10px 0;
        font-size: 18px;
    }
    .status-uploaded { color: #ff9800; }
    .status-processing { color: #2196F3; }
    .status-processed { color: #4CAF50; }
    .status-failed { color: #f44336; }
    .upload-section {
        background: #f5f5f5;
        padding: 20px;
        border-radius: 8px;
    }
    .upload-section input {
        display: block;
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid #ddd;
        border-radius: 4px;
    }
    .upload-section button {
        background: #667eea;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
    }
    .upload-section button:hover {
        background: #764ba2;
    }
    .success { color: #4CAF50; }
    .error { color: #f44336; }
</style>
